@import java.net.URI
@import java.time.LocalDateTime
@import java.time.format.DateTimeFormatter
@(report: Report, events: List[(Event, Option[User])], files: List[ReportFile])(implicit websiteUrl: URI)

<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width" />

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Détail du signalement @report.id</title>

        <link rel="stylesheet" href="@routes.Assets.versioned("css/report.css")">

    </head>
    <body>
        <div>
            <div>
                <img src='@routes.Assets.versioned("images/logo-marianne.png")' height="1.8cm"/>
                <img src='@routes.Assets.versioned("images/logo-signal-conso.png")' height="1.7cm"/>
            </div>
            <div class="mt-5">
                <small>
                    Identifiant unique : @report.id<br>
                    Ce document a été extrait le : @LocalDateTime.now().format(DateTimeFormatter.ofPattern(("dd/MM/yyyy à HH:mm:ss")))
                </small>
            </div>
            <div>
                <h2>Type de signalement</h2>
                <ul>
                    <li>
                        @report.category
                    </li>
                    @report.subcategories.map{subcat =>
                        <li>
                            @subcat
                        </li>
                    }
                </ul>
                <h2>Détail du signalement</h2>
                <ul>
                    @report.details.map{input =>
                        <li>
                            <b>@Html(input.label)</b> @input.value
                        </li>
                    }
                </ul>
                <h2>Entreprise</h2>
                @report.companySiret.map{siret =>
                    <div>
                        <b>@siret</b>
                    </div>
                }
                @report.companyAddress.map{address =>
                    <div>
                        @views.html.fragments.address(address)
                    </div>
                }
                @report.websiteURL.map{url =>
                    <div>
                        @url
                    </div>
                }
                <h2>Consommateur</h2>
                @if(!report.contactAgreement) {
                    <div class="note">Le consommateur souhaite rester anonyme</div>
                }
                <div>
                    <b>@report.firstName @report.lastName</b>
                </div>
                <div>
                    @report.email
                </div>
            </div>
            <div>
                <h2>Pièces jointes</h2>
                @if(files.isEmpty) {
                    <span>Aucune pièce jointe n'est associée à ce signalement.</span>
                } else {
                    Pièces jointes :
                    <ul>
                    @files.map{f =>
                        <li>@f.filename</li>
                    }
                    </ul>
                }
            </div>
            <div>
                <h2>Historique</h2>
                @events.map{case (e, u) =>
                    <p>
                        <span class="note">@e.formattedDate</span>
                        <br />
                        <b>@e.action.value</b>
                        <br />
                        @e.getDescription
                    </p>
                }
                <p>
                    <span class="note">@report.creationDate.format(java.time.format.DateTimeFormatter.ofPattern("d MMMM yyyy à HH:mm:ss"))</span>
                    <br />
                    <b>Création du signalement</b>
                </p>
            </div>
            <div class="footer text-center">
                <img src='@routes.Assets.versioned("images/logo-ministere.png")'/>
            </div>
        </div>
    </body>
</html>